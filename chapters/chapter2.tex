\documentclass[../main.tex]{subfiles}

\begin{document}

\chapter{Methods}\label{chapter2}
\section{\textit{Cis}-regulatory module analysis}\label{chapter2:methods:cis-regulatory-module-analysis}
%add short summary paragraph linking to the last paragraph of the intro
All data analysis and plotting was done using Python 3.7.8 \autocite{pythoncoreteamPythonDynamicOpen2020}.
%name Python version too eg. 3.7.3
The Shapiro\hyp{}Wilk normality test~\autocite{shapiroAnalysisVarianceTest1965} and Levene's homogeneity of variance~\autocite{leveneRobustTestsEquality1960} were used to test assumptions for parametric tests.
For non\hyp{}parametric analyses the Kruskal\hyp{}Wallis \textit{H} test \autocite{kruskalUseRanksOneCriterion1952} was used to test for differences between promoter categories using the scikit-posthocs package (v0.6.4)\autocite{terpilowskiScikitposthocsPairwiseMultiple2019}.
If necessary, Dunn's post hoc tests \autocite{dunnMultipleComparisonsUsing1964} were used with Bonferroni adjustment for multiple comparisons using the pingouin.kruskal package (v0.3.7)\autocite{vallatPingouinStatisticsPython2018}.
All plots were created using Seaborn (v0.10.1) \autocite{michael_waskom_2020_3767070}.
Significance annotations were added to plots using Statannot (v0.2.3; \url{https://github.com/webermarcolivier/statannot}).

\subsection{Extraction of \textit{cis}-regulatory modules}\label{chapter2:methods:extraction-of-cis-regulatory-modules}

Promoters were extracted from the Arabidopsis TAIR 10 \autocite{lameschArabidopsisInformationResource2012} genome assembly and Ensembl Plants \autocite{howeEnsemblGenomes20202020} annotation (\href{ftp://ftp.ensemblgenomes.org/pub/release-47/plants/gff3/arabidopsis_thaliana/}{.gff3 release 47 date 08/03/2020}) using a custom Python script (\href{https://github.com/Switham1/PromoterArchitecture/blob/master/src/data_sorting/extract_promoter.py}{extract\_promoter.py}, available at \url{https://github.com/Switham1/PromoterArchitecture}).
Only promoters from genes on Arabidopsis chromosomes 1\textendash{}5 were extracted.
Using the same Python script promoters were extracted from protein coding genes that did not overlap other protein coding genes using pybedtools (version 0.8.1) \autocite{dalePybedtoolsFlexiblePython2011}.
%What pybedtools version?
Promoters were extracted 1000 base pairs (bp) upstream of the longest annotated transcript transcription start site (TSS) or until the nearest annotated protein coding gene, and 5$\prime$ UTRs were included downstream of the TSS up until the closest annotated coding sequence (CDS) ATG start codon.
Genes where the whole promoter overlapped a protein coding gene, leaving only part of the 5$\prime$ UTR non-overlapping, were flagged and filtered out.
%This is because coding sequences have different conservation patterns to non-coding regions.%see intro XXX%
%Promoters with an upstream gene oriented in the reverse direction less than 2000 bp away were flagged to mitigate for potentially overlapping promoters.
%This was because with overlapping promoters it is difficult to determine whether CREs belong to one promoter over the other or are used by both promoters.

\subsection{Transcription factor binding site identification}\label{chapter2:methods:transcription-factor-binding-site-identification}

%Add all software versions
The resulting promoter annotations were transformed to bed format using BEDOPS (version 2.4.39) gff2bed~\autocite{nephBEDOPSHighperformanceGenomic2012}, and BEDTools (version 2.29.2) getfasta~\autocite{quinlanBEDToolsFlexibleSuite2010} was used to extract promoter sequences from the reference genome.
Promoters were scanned for DAP\hyp{}seq TFBS motifs~\autocite{omalleyCistromeEpicistromeFeatures2016} using FIMO~\autocite{grantFIMOScanningOccurrences2011} (version 5.1.1) with a zero\hyp{}order background model created using fasta\hyp{}get\hyp{}markov~\autocite{baileyMEMESuiteTools2009}.
A \textit{p}\hyp{}value threshold of \textasciitilde{}0.0001 and max stored sequences \textasciitilde{}5000000 was used, and the output was filtered using a \textit{q}\hyp{}value threshold of 0.05.
Arabidopsis gene IDs for promoters and the TFs binding them were recovered for further analysis.

\subsection{Gene selection}\label{chapter2:methods:gene-selection}

To investigate the stability of gene expression, \textcite*{czechowskiGenomeWideIdentificationTesting2005} analysed microarray data from \textit{Arabidopsis thaliana} Col-0 across 79 different tissues, organs and developmental stages.
This data enables genes to be ranked according to stability of expression across tissues using coefficient of variation (CV) values.
The Tau tissue\hyp{}specificity \autocite{yanaiGenomewideMidrangeTranscription2005} was calculated for each gene and then the 100 most tissue\hyp{}specific and 100 most non\hyp{}specific genes were chosen.
Only genes which had at least one TFBS found in their promoters using FIMO (see \autoref{chapter2:methods:transcription-factor-binding-site-identification}) were ranked according to CV and Tau.

Recreating the methodology used by \textcite*{czechowskiGenomeWideIdentificationTesting2005}, only genes expressed in \SI{80}{\percent} of conditions and developmental stages based on mas5 calls were included when calculating CV.
This step filtered out 10764 genes leaving 12046 genes.
CV was used to select the 100 most constitutively expressed genes from raw expression data generated in their study.
Alongside this, the 100 most variable genes were chosen.
100 control genes were randomly selected from the central distribution of the expression CV ranked genes using the Tau ranking.
This ensured that the selected genes were present in both CV and Tau datasets.
To ensure even coverage, 10 genes were selected randomly from each of 10 bins covering the range of Tau values between the non\hyp{}specific and tissue\hyp{}specific gene sets.


\subsection{Sliding window creation}\label{chapter2:methods:sliding-window-creation}

%describe how sliding windows were created%
Promoters were split into 100 bp sliding windows with a 50 bp step size using a custom Python script (\href{https://github.com/Switham1/PromoterArchitecture/blob/master/src/rolling_window/rolling_window.py}{rolling\_window.py}, available at \url{https://github.com/Switham1/PromoterArchitecture}).
Windows with fewer than 100 promoters extending to that location were removed.
For each sliding window plot, the median percentage GC content, TFBS coverage, open chromatin coverage or TF diversity was calculated. \SI{95}{\percent} confidence intervals were estimated using 10000 bootstraps.

\subsection{GC content}\label{chapter2:methods:gc-content}

%name the script and say how
Percentage GC content of promoters and each promoter window was determined using Python to test the hypothesis that constitutive genes have a higher GC content than variable genes and the hypothesis that non\hyp{}specific genes have a higher GC content than tissue\hyp{}specific genes.
%The Mann\hyp{}Whitney U test~\autocite{mannTestWhetherOne1947}


\subsection{Transcription factor binding site coverage}{\label{chapter2:methods:transcription-factor-binding-site-coverage}}

To test the hypotheses that the CRMs of variable genes will have a lower percentage of base pairs covered by at least one TFBS than CRMs of constitutive genes, and that tissue\hyp{}specific CRMs will have a lower percentage of base pairs covered than non\hyp{}specific CRMs, the BEDTools (v2.29.2) coverage tool was utilised \autocite{quinlanBEDToolsFlexibleSuite2010}.
The number of base pairs covered by at least one motif in a given sequence was calculated using the BEDTools coverage tool.
%The proportion of base pairs covered by TFBSs in promoters from different expression types were compared using the Kruskal\hyp{}Wallis \textit{H} test and Bonferroni
%The proportion of base pairs covered by TFBSs in constitutive promoters was compared to variable promoters using a Mann Whitney U test~\autocite{mannTestWhetherOne1947}.

\subsection{Open chromatin coverage}\label{chapter2:methods:open-chromatin-coverage}
%talk about open chromatin in the intro
Negative control (treated with \SI{5}{\micro\Molar} NaOH) ATAC\hyp{}seq data was downloaded from \textcite{potterCytokininModulatesContextdependent2018} for root and shoot tissues.
Individual bed files for each replicate were concatenated and BEDTools (v2.29.2) merge \autocite{quinlanBEDToolsFlexibleSuite2010} was used to combine overlapping peaks.
An intersection for root and shoot open chromatin was created using BEDTools intersect \autocite{quinlanBEDToolsFlexibleSuite2010}.
To test the hypothesis that the CRMs of variable genes will have a lower proportion of open chromatin than constitutive CRMs, and that non\hyp{}specific CRMs will have a lower proportion of open chromatin than tissue\hyp{}specific CRMs, BedTools coverage tool \autocite{quinlanBEDToolsFlexibleSuite2010} was used.
The number of base pairs covered by root, shoot or the root\hyp{}shoot intersect open chromatin was calculated using BedTools coverage.
%clearly explain the bootstrapping methodology

\subsection{TF diversity}\label{chapter2:methods:tf-diversity}

The unique TF count for each promoter and promoter window was calculated. This meant that if TFBSs for a TF were found several times within a promoter, that TF was only counted once.
TFs were only classed as present in a promoter window if the centre of the TFBS was inside the window.
To test the hypothesis that constitutive CRMs will have a more diverse TFBS profile than variable CRMs, and that non\hyp{}specific CRMs will have a more diverse TFBS profile than tissue\hyp{}specific CRMs, the Shannon diversity was calculated.
The mapped motif annotations were analysed using the the skbio.diversity.alpha.shannon Python module (v0.5.6; \url{https://github.com/biocore/scikit-bio}) to calculate the Shannon diversity of individual TFs and also TF families binding each promoter or promoter window.
%Python module version
The Shannon diversity, unique TFBS counts and raw TFBS counts were analysed comparing constitutively expressed promoters to variable promoters.
%The Mann\hyp{}Whitney U test was used~\autocite{mannTestWhetherOne1947}.

As documented in \href{https://github.com/Switham1/PromoterArchitecture/blob/master/src/plotting/TF_diversity_plots_wholeprom.ipynb}{\texttt{TF\_diversity\_plots\_wholeprom.ipynb}} (available at \url{https://github.com/Switham1/PromoterArchitecture}), a table was created containing each promoter on a different row with each TF family in a different column.
The numbers in each cell represent the number of times TFs belonging to a particular TF family are predicted to bind to a certain promoter.
A principle component analysis was run where \SI{95}{\percent} of the variation was maintained with 22 components.
Then hierarchical clustering was used (Python code from \url{http://www.nxn.se/valent/extract-cluster-elements-by-color-in-python}) to estimate the number of clusters, K, to be used in Kmeans clustering.
The number of clusters was predicted using the silhouette method \autocite{rousseeuwSilhouettesGraphicalAid1987} and then used as K in Kmeans clustering using the sklearn.cluster.KMeans Python module (\url{https://github.com/scikit-learn/scikit-learn/tree/master/sklearn/cluster}).
%version?

\subsection{TATA box enrichment}\label{chapter2:methods:tata-box-enrichment}

15 bp TATA box locations were downloaded from Eukaryotic Promoter Database (release: At\_EPDnew\_004) \autocite{dreosEukaryoticPromoterDatabase2017} present between -50 to 0 relative to the EPD TSS.
Genomic Association Tester (GAT) \autocite{hegerGATSimulationFramework2013} (version 1.3.6) was used to
compare enrichment of TATA boxes in constitutive and variable genes to test the hypothesis that variable genes are enriched for TATA boxes over constitutive genes, and to test the hypothesis that tissue\hyp{}specific genes are enriched for TATA boxes over non\hyp{}specific genes.
The 15 bp TATA boxes were used as segments of interest.
Constitutive and variable promoter annotations were separately tested for enrichment of TATA boxes compared to the background workspace file containing all 200 promoters of interest from both categories.
Non\hyp{}specific and tissue\hyp{}specific promoter categories were tested in the same way.

\subsection{Transcription factors binding \textit{cis}\hyp{}regulatory modules}\label{chapter2:methods:tfs-binding-crms}

The coefficient of variation (CV) and Tau tissue\hyp{}specificity of TFs binding CRMs were mapped to each CRM.
The hypothesis that there is no significant difference in CV of TFs binding CRMs in constitutive or variable categories and no significant difference in Tau of TFs binding CRMs in non\hyp{}specific or tissue\hyp{}specific categories was tested (\href{https://github.com/Switham1/PromoterArchitecture/blob/master/src/plotting/map_TF2CV_TF2Tau_combined.py}{map\_TF2C\_TF2Tau\_combined.py}, available at \url{https://github.com/Switham1/PromoterArchitecture}).

\subsection{Functional analysis}\label{chapter2:methods:functional-analysis}

A background gene set of all protein coding genes remaining after the filtering steps mentioned in \autoref{chapter2:methods:extraction-of-cis-regulatory-modules} (Extraction of \textit{cis}\hyp{}regulatory modules) was used so that all promoters contained at least one TFBS when scanned using FIMO \autocite{grantFIMOScanningOccurrences2011}.
Gene ontology (GO) terms (go-basic.obo; 2020\textendash{}08\textendash{}11 release) were downloaded from the GO FTP site (\url{http://www.geneontology.org/GO.current.annotations.shtml}).
GOATOOLS \autocite{klopfensteinGOATOOLSPythonLibrary2018} (version 1.0.6) was used for gene ontology enrichment analysis using Fisher's exact test \autocite{fisherInterpretationContingencyTables1922} and Benjamini/Hochberg false discovery rate (FDR) correction \autocite{benjaminiControllingFalseDiscovery1995}.
clusterProfiler \autocite{yuClusterProfilerPackageComparing2012} (version 3.14.0) was used for (KEGG) gene set enrichment analysis \autocite{kanehisaKEGGKyotoEncyclopedia2000} with Benjamini/Hochberg FDR correction \autocite{benjaminiControllingFalseDiscovery1995}.

\section{Cloning into standard parts}\label{chapter2:methods:cloning-into-standard-parts}

Benchling design software (available at \url{http://www.benchling.com}; unpublished) was used to design and create plasmid maps.
Plasmids containing basic DNA parts such as promoters and coding sequences (CDSs) were constructed.
These are called level 0 standard parts~\autocite{marillonnetSyntheticDNAAssembly2020}.
Any illegal restriction enzyme sites mutated out as described in~\textcite*{patronStandardsPlantSynthetic2015}.
The level 0 standard parts were assembled into complete expression vectors called level 1 plasmids.

\subsection{Synthetic promoters}\label{chapter2:methods:synthetic-promoters}

To test promoters transiently in plants they were cloned into level 0 standard vectors~\autocite{marillonnetSyntheticDNAAssembly2020}.
Arabidopsis TFBSs consensus sequences were identified on \url{http://neomorph.salk.edu/dev/pages/shhuang/dap_web/pages/browse_table_aj.php}.
The first batch of synthetic promoters contained TFBSs as follows: 1xANR1, 1xNLP7, 1x[TCP20-NLP7], 4xANR1, 4xNLP7, 4x[TCP20-NLP7], 4xNRE (plasmids pEPSW0CM0095\textendash{}101).
The second batch of synthetic promoters contained TFBSs as follows: 4x[NRE-TATA] no spacing, 4x[NRE-TATA] separated by 20bp spacing downstream of NRE, 4x[NRE-random] (equal ATGC ratios), 4x[NRE-random] (equal ATGC ratios) separated by 20bp spacing downstream of NRE, 3xHHO2-minsyn\_105, minsyn\_105—3xHHO2, 4x[bZIP3-random], 4x[TGA1-random], 2x[bZIP3-random-NRE-random], 2x[TGA1-random-NRE-random] (plasmids pEPSW0CM0336\textendash{}345).
A negative control STAP4 promoter was created (pEPSW0CM0093).
All synthetic promoters were assembled into level 1  loop pCk1~\autocite{pollakLoopAssemblySimple2018} backbones containing the synthetic promoter followed by a STAP4 core promoter (pEPSW0CM0094), a TMV 5$\prime$ UTR (pICH41402), a Nano luciferase (LucN) coding sequence (pEPYC0CM0133), a pICSL50007 C terminal FLAG tag (Addgene: \url{https://www.addgene.org/50308/}) and a pICH41421 \textit{NOS} terminator (Addgene: \url{https://www.addgene.org/50339/}).
The experimental calibrator plasmids~pEPSW1KN0034 (\textit{35S:TMV}:LucF) and pEPSW1KN0072 (\textit{UBQ10}:LucF) were constructed.
The positive control plasmids pEPSW1KN0035 (\textit{NOS}:LucN) and pEPSW1KN0071 (\textit{UBQ10}:LucN) and the nitrate responsive positive control promoters pEPSW1KN0025 (\textit{NIR1}:LucN) and~pEPSW1KN0092 (\textit{NRP}:LucN) were constructed.
%(See supplementary table 1). insert supplementary table 1 containing addgene links/papers

\subsection{Transcription factors}\label{chapter2:methods:synthetic-transcription-factors}

CDSs (see section~{\ref{chapter2:methods:gene-selection}} gene selection) were imported into Benchling (available at \url{http://www.benchling.com}; unpublished) from EnsemblPlants (release 42~\autocite{kerseyEnsemblGenomes20182018}).
Any illegal restriction enzyme sites were mutated to synonymous codons with similar Arabidopsis codon usage.
CDSs were ordered from Twist Bioscience.
These included ANAC032 (AT1G77450), ANR1 (AT2G14210), ARF18 (AT3G61830), ARF9 (AT4G23980), NLP6 (AT1G64530), NLP7 (AT4G24020), DREB26 (AT1G21910), TCP20 (AT3G27010), TGA1 (AT5G65210), bZIP3 (AT5G15830) and HHO2 (AT1G68670).

For transient plant co\hyp{}expression assays these were assembled into level 1 loop pCk2~\autocite{pollakLoopAssemblySimple2018} expression plasmids containing a 35s:TMV promoter (pICH51277), the CDS of interest and the 35s terminator (pICH41414).
% Mention protein expression in \textit{E. coli}.

%For each gene, both promoter and 5'UTR were used.
%Two lengths for each promoter were studied: a 500 bp and 1000 bp stretch upstream of the transcription start site (TSS) annotated on Araport 11~\autocite{chengAraport11CompleteReannotation2017}.

%The previously assembled level 0 basic parts were assembled into 24 complete expression vectors called level 1 plasmids~\autocite{marillonnetSyntheticDNAAssembly2020}.
% Plasmids containing these genes were created for transient protein expression in~\textit{E. coli} (pOpinF backbone: \url{https://www.addgene.org/26042/}; plasmids
% pEPSW1KN0079-84). The same 6 N\hyp{}responsive coding sequences were used in plasmids for cell free protein synthesis (pEPSW1KN0085-90).

\subsection{Design of guides and construction of CRISPR library}\label{chapter2:methods:design-of-guides}
Four nitrogen master regulator genes were chosen to target within the gene regulatory subnetwork.
These were ARF18 (AT3G61830), ARF9 (AT4G23980), DREB26 (AT1G21910) and NLP7 (AT4G24020).
Shoot and root ATAC-seq data (see section~\ref{chapter2:methods:open-chromatin-coverage} Open chromatin coverage \autocite{potterCytokininModulatesContextdependent2018}) was overlayed over the non-coding regions upstream of the ATG start codon of each gene.
A region of \textasciitilde{}500 bp falling within open chromatin was chosen for each Arabidopsis gene and was scanned for SpCas9 NGG PAM sites using CRISPOR~\autocite{concordetCRISPORIntuitiveGuide2018} (TAIR 10 \autocite{lameschArabidopsisInformationResource2012} genome assembly, Ensembl Plants \autocite{howeEnsemblGenomes20202020} version 76).
Using a custom Python \autocite{pythoncoreteamPythonDynamicOpen2020} script (available on GitHub: \url{https://github.com/Switham1/PromoterArchitecture/blob/master/src/CRISPR_library/Choose_guides.ipynb}), guides with on\hyp{}target efficiency \autocite{doenchOptimizedSgRNADesign2016} of \textless{}\SI{40}{\percent} were filtered out.
Roughly 30 guides per gene were chosen.
Each guide was allocated at least once to a guide pair roughly 90-110 bp apart, generating 96 PAM pairs.
This was to increase the chance of large deletions between the two PAM sites.
Virtual Chen \autocite{chenDynamicImagingGenomic2013} guide scaffolds were created using virtual PCRs, then all virtual plasmid maps were generated using PyDNA (version 3.0.2 \autocite{pereiraPydnaSimulationDocumentation2015}) and DNA Cauldron (version 2.0.1; \url{https://github.com/Edinburgh-Genome-Foundry/DnaCauldron}).
Once the assembly plan was generated, 122 guide scaffolds, 122 sgRNA cassettes and 96 SpCas9 final constructs each containing a guide pair were assembled in the lab.
%see supplementary table
The final constructs used a pCsA loop acceptor~\autocite{pollakLoopAssemblySimple2018} with pepsw1kn0114 (\textit{NOS:TMV}-nptII-\textit{OCS}; kanamycin resistance) in position 1, pepsw1kn0333 (\textit{YAO}:Cas9 (with potato intron IV2):\textit{E9}; as in plasmid BCJJ345 on Addgene: \url{https://www.addgene.org/117504/} \autocite{castelOptimizationTDNAArchitecture2019}) in position 2, \textit{U626}:guide1 in position 3 and \textit{U626}:guide2 in position 4.

\subsection{Digestion-ligation reaction}\label{chapter2:methods:digestion-ligation-reaction}

In a \SI{0.2}{\milli\litre} PCR tubes or 96 well plates one-step digestion-ligation reactions were carried out, as detailed in Support Protocol 1 in \textcite*{patronDNAAssemblyPlant2016}, with a few alterations.
A final reaction volume of \SI{10}{\micro\litre} per well was used instead of \SI{20}{\micro\litre}, with final concentrations of \SI{1}{\nano\Molar} of acceptor
plasmid and \SI{2}{\nano\Molar} of coding sequence DNA.
For the pUAP1 and pUPD2 acceptor plasmids, a 1X final concentration of New England Biolabs (NEB) T4 DNA ligase buffer (final concentration: \SI{50}{\milli\Molar} Tris-HCl, \SI{10}{\milli\Molar} MgCl\textsubscript{2}, \SI{1}{\milli\Molar} ATP, \SI{10}{\milli\Molar} DTT) was used.
For pUAP4, a final concentration of 1X NEB CutSmart buffer with added ATP (final concentration: \SI{50}{\milli\Molar} potassium acetate, \SI{20}{\milli\Molar} Tris-acetate, \SI{10}{\milli\Molar} magnesium acetate, \SI{100}{\micro\gram\per\ml} BSA, \SI{1}{\milli\Molar} ATP) was used.
5 U \si{\per\ul} of T4 DNA ligase was added, \SI{0.1}{\micro\gram\per\ul} of bovine serum albumin and 0.25 U \si{\per\micro\litre} of restriction enzyme (BpiI, BsmBI or SapI) was used. Reactions were topped up with distilled deionised water to the \SI{10}{\micro\litre} total reaction volume of \SI{10}{\micro\litre}.

For the digestion-ligation reaction, a PCR program was used with an initial incubation at \SI{37}{\degreeCelsius} for 20 seconds, followed by 26 cycles of \SI{37}{\degreeCelsius} for three minutes then \SI{16}{\degreeCelsius} for four minutes.
After these 26 cycles, the reaction was completed with a five minute incubation at \SI{50}{\degreeCelsius} followed by a five minute incubation at \SI{80}{\degreeCelsius}.

\subsection{Transformation of electrocompetent~\textit{Escherichia coli}}\label{chapter2:methods:transformation-of-electrocompetent-escherichia-coli}

On ice, \SI{0.5}{\micro\litre} of assembly reaction was mixed with \SI{3}{\micro\litre} of NEB 5-alpha electrocompetent \textit{E. coli} (C2987) in PCR tubes, and was mixed by gently pipetting up and down 1 or 2 times.
After 30 minutes on ice, cells were transformed by heatshocking at \SI{42}{\degreeCelsius} for 30 seconds in a metal bead incubator. Tubes were placed on ice for 5 minutes.
\SI{20}{\micro\litre} of LB (Luria-Bertani) liquid medium was added to each tube, and they were mixed by flicking the tubes.
Tubes were incubated at \SI{37}{\degreeCelsius} for 60 minutes with 250 rpm shaking (New Brunswick Innova\textsuperscript{®} 44 incubator shaker).
For level 0 plasmids, \textit{E. coli} media was spread on chloramphenicol (\SI{35}{\micro\gram} ml\textsuperscript{-1} final concentration) selective LB agar plates, and when using acceptors pUPD2 and pUAP4, blue/white colony selection was used with x-gal (\SI{20}{\micro\gram\per\ml} final concentration) and IPTG (\SI{0.1}{\milli\Molar} final concentration) added to the agar.
Plates were split into 4 sections each for different transformed \textit{E. coli} strains to increase throughput.
These were incubated overnight at \SI{37}{\degreeCelsius}.

White colonies were selected and transferred to master plates split into grids to allow many strains on one plate.
To ensure cells contained vectors with the desired insert, colony PCR was utilised.
A \SI{10}{\ml} reaction volume was used, with final concentrations: 1X Promega Green GoTaq\textsuperscript{®} Flexi buffer, \SI{4}{\milli\Molar} MgCl\textsubscript{2} (including that present already in GoTaq\textsuperscript{®} buffer), \SI{0.2}{\milli\Molar} of each dNTP, 0.025 U \si{\per\micro\litre} GoTaq\textsuperscript{®}DNA polymerase, \SI{0.4}{\milli\Molar} each of pUAP\hyp{}DP2 forward and reverse primers (primers will be made available on a GitHub repository in the future).
A PCR program was used with an initial incubation at \SI{95}{\degreeCelsius} for 3 minutes, followed by 26 cycles of: \SI{95}{\degreeCelsius}, 30 seconds then \SI{60}{\degreeCelsius}, 30 seconds then \SI{72}{\degreeCelsius}, 2 minutes.
After the last cycle, an incubation period of \SI{72}{\degreeCelsius} for 5 minutes was used.

Colonies with correct insert sizes were grown overnight in \SI{100}{\ml} liquid LB with kanamycin (\SI{50}{\micro\gram\per\ml} final concentration), chloramphenicol (\SI{35}{\micro\gram\per\ml} final concentration) or ampicillin (\SI{50}{\micro\gram\per\ml} final concentration) selection depending on the plasmid resistance gene in a shaker incubator at \SI{37}{\degreeCelsius}.
\SI{20}{\percent} glycerol stocks were taken and stored at \SI{-70}{\degreeCelsius}.
QIAGEN Plasmid~\textit{Plus} Midi Kit with manifold was used to extract and purify DNA.
DNA concentration was measured on a CLARIOstar Plus plate reader.
Constructs were sequenced by IDT, Eurofins or Genewiz in both directions to confirm identity.
Plasmid details can be found in {Supplementary Table 1}.

\section{Plant growth}{\label{chapter2:methods:plant-growth}}

Seeds were sterilised in \SI{70}{\percent} ethanol for 2 minutes then in sodium hypochlorite 1:2 dilution for 5 minutes.
They were washed 5 times in sterile deionised water.
Seeds were stratified in the dark at \SI{4}{\degreeCelsius} for at least 24 hours.
Arabidopsis plants were grown in soil with long day (18 hour days, 6 hour nights) cycles at \SI{22}{\degreeCelsius}.

\section{Protoplast preparation and transfection}\label{chapter2:methods:protoplast-preparation-and-transfection}

Arabidopsis plants were transferred to short day (8 hour day, 16 hour nights) light cycle for at least 3 days before protoplast extraction.
Leaf protoplasts were prepared for the ratiometric assay.
Protoplasts were extracted from Arabidopsis leaf tissue grown in soil for 3\textendash{}4 weeks.
Protoplast extraction was carried out as described~\autocite{yooArabidopsisMesophyllProtoplasts2007}, with some alterations.
Plant tissue was added to a petri dish and chopped into \textasciitilde{}\SI{4}{\mm} lengths.
The enzyme digestion solution was added containing \SI{1.5}{\percent} cellulase and \SI{0.3}{\percent} macerozyme.
Leaves were digested for 4 hours at \SI{22}{\degreeCelsius} with shaking.
During filtering (\SI{75}{\micro\litre} filter) \SI{2}{\ml} (leaf) of W5 solution was used to wash the protoplasts.
After filtering, protoplasts were centrifuged at 200~RCF (leaf) for 2 minutes.
After leaving on ice to settle for 30 minutes, supernatant was removed and \SI{1}{\ml} of MMG solution was added.
Using a cut pipette tip, leaf protoplasts were loaded to the top of \SI{5}{\ml} of \SI{21}{\percent} sucrose solution in a \SI{15}{\ml} centrifuge tube.
This was centrifuged for 10 minutes at 90 RCF at \SI{4}{\degreeCelsius}.
The supernatant above the cloudy protoplast layer was removed.
The protoplast layer was transferred to another \SI{15}{\ml} centrifuge tube on ice.
Protoplasts were diluted to \textasciitilde{}\SI{2e5}{\ml} with MMG solution on ice.
%Leaf and root protoplasts were prepared for the ratiometric assay.
% Protoplasts were extracted from Arabidopsis leaf or root tissue, grown either hydroponically or in sterile vertical plates for 3\hyp{}6 weeks.
% Protoplast extraction was carried out as described~\autocite{yooArabidopsisMesophyllProtoplasts2007}, with some alterations.
% Briefly, plant tissue was extracted from the agar or hydroponics, washed with distilled water then added to a petri dish and chopped into \textasciitilde{}\SI{4}{\mm} lengths.
% The enzyme digestion solution was added containing \SI{3}{\percent} cellulase (Duchefa Biochemie cellulase R-10 CAS no. 9012-54-8) and \SI{0.6}{\percent} macerozyme (Duchefa Biochemie macerozyme R-10 CAS no. 9032-75-1) for root digestion.
% For leaf digestion \SI{1.5}{\percent} cellulase and \SI{0.3}{\percent} macerozyme were used. Roots were digested overnight in the dark at \SI{22}{\degreeCelsius}.
% Leaves were digested for 4 hours at \SI{22}{\degreeCelsius} with shaking.
% During filtering (\SI{75}{\micro\litre} filter), \SI{4}{\ml} (root) or \SI{2}{\ml} (leaf) of W5 solution was used to wash the protoplasts.
% After filtering, protoplasts were centrifuged at 400~RCF (root) or 200~RCF (leaf) for 2 minutes.
% After leaving on ice to settle for 30 minutes, the solution was centrifuged for 2 minutes at 400 RCF (root) or 200 RCF (leaf).
% Supernatant was removed, and \SI{1}{\ml} of MMG solution was added.
% Using a cut pipette tip, leaf protoplasts were loaded to the top of \SI{5}{\ml} of \SI{21}{\percent} sucrose solution in a \SI{15}{\ml} centrifuge tube.
% This was centrifuged for 10 minutes at 90 RCF at \SI{4}{\degreeCelsius}.
% The supernatant above the cloudy protoplast layer was removed.
% The protoplast layer was transferred to another \SI{15}{\ml} centrifuge tube on ice.
% The sucrose cushion step was skipped for root protoplasts.
% Protoplasts were diluted to \SI{2e5}{\ml} with MMG solution on ice.

In a 96 deep well plate, the following plasmid solutions were added to
wells each with a total mass of \SI{5}{\micro\gram} DNA: \textit{35S}:\textit{TMV}:firefly
luciferase (LucF) plasmid (pEPSW1KN0034) or \textit{UBQ10:}LucF
(pEPSW1KN0072) delivery calibrators were added to all wells. Plasmids
containing test promoters controlling nano luciferase (LucN) were added to a total of \SI{5}{\micro\gram} DNA. For the positive control wells \textit{NOS}:LucN
(pEPSW1KN0035), \textit{35S}:LucN (pEPSW1KN0070) and/or \textit{UBQ10}:LucN
(pEPSW1KN0071) were used. For the negative control \textit{STAP4:}LucN
(pEPSW1KN0036) was used. For the nitrate responsive positive
control \textit{NIR1}:LucN and/or \textit{NRP:}LucN (pEPSW1KN0092) was used. All samples were run in triplicate.

For TF\hyp{}promoter co\hyp{}expression experiments only test plasmids containing 1000 bp promoters were used.
\SI{1000}{\fmol} of each plasmid was added, apart from the delivery calibrator \textit{35s:TMV}:LucF (pEPSW1KN0072) where \SI{500}{\fmol} were added.
In these experiments, one or more plasmids coding for TFs under the control of~\textit{35S}:TMV were co\hyp{}expressed with a plasmid containing the promoter of interest controlling LucN.
The promoters tested contained the consensus binding sites for the TFs that were co\hyp{}expressed with them.
The total concentration of TF plasmids added was \SI{1000}{\fmol}. If more than one TF was co-expressed in the same well, they were added in equimolar ratios (e.g., \SI{500}{\fmol} of TF A, \SI{500}{\fmol} of TF B).

\SI{200}{\micro\litre} of protoplast solution (\SI{e5}{\per\ml}) was slowly added to each well, using cut pipette tips to avoid damaging cells.
\SI{200}{\micro\litre} + \si{\micro\litre} of plasmid solution added of PEG solution was added to each well, and the plate was covered and inverted 20 times to mix.
\SI{1.2}{\ml} of W5 solution was added, and plate was inverted 20 times to mix.
The plate was centrifuged at 400~RCF (root) or 100~RCF (leaf) for 2 minutes, and supernatant was removed.
Leaf protoplasts were resuspended with \SI{120}{\micro\litre} W5, instead of WI solution.
For nitrate induction experiments W5 containing \SI{10}{\milli\Molar} KNO\textsubscript{3} was used instead for either overnight induction or induction for 2 hours before continuing to the luciferase assay.
Root protoplasts were resuspended in either replete (0.4 M glucose, \SI{3}{\milli\Molar} MES, major salts~\autocite{nagyCallusInductionPlant1976}: \SI{24.72}{\milli\Molar} KNO\textsubscript{3}, \SI{1.01}{\milli\Molar} (NH\textsubscript{4})\textsubscript{2}SO\textsubscript{4}, \SI{1.01}{\milli\Molar} MgSO\textsubscript{4}.7H\textsubscript{2}O, \SI{1.48}{\milli\Molar} KH\textsubscript{2}PO\textsubscript{4}, \SI{3.12}{\milli\Molar} NH\textsubscript{4}NO\textsubscript{3}, \SI{0.89}{\milli\Molar} CaCl\textsubscript{2}, minor salts~\autocite{gamborgNutrientRequirementsSuspension1968}: \SI{101.9}{\micro\Molar} H\textsubscript{3}BO\textsubscript{3}, \SI{100.05}{\micro\Molar} MNCl.4H\textsubscript{2}O, \SI{31.99}{\micro\Molar} ZnSO\textsubscript{4}.7H\textsubscript{2}O, \SI{5}{\micro\Molar} KI, \SI{1.03}{\micro\Molar} Na\textsubscript{2}MoO\textsubscript{4}.2H\textsubscript{2}O, \SI{0.1}{\micro\Molar} CuSO\textsubscript{4}.5H\textsubscript{2}O, \SI{0.09}{\micro\Molar} COCl\textsubscript{2}.6H\textsubscript{2}O, \SI{100}{\micro\Molar}  NaFe\hyp{}EDTA, \SI{0.12}{\gram\per\l} Gamborg B5 vitamins) or nitrate\hyp{}free (\SI{0.4}{\Molar} glucose, \SI{3}{\milli\Molar} MES, major salts \autocite{nagyCallusInductionPlant1976}: \SI{156.3}{\milli\Molar} glutamine, \SI{1.01}{\milli\Molar} (NH\textsubscript{4})\textsubscript{2}SO\textsubscript{4}, \SI{1.01}{\milli\Molar} MgSO\textsubscript{4}.7H\textsubscript{2}O, \SI{1.48}{\milli\Molar} KH\textsubscript{2}PO\textsubscript{4}, \SI{0.89}{\milli\Molar} CaCl\textsubscript{2}, minor salts~\autocite{gamborgNutrientRequirementsSuspension1968}: \SI{101.9}{\micro\Molar} H\textsubscript{3}BO\textsubscript{3}, \SI{100.05}{\micro\Molar} MNCl.4H\textsubscript{2}O, \SI{31.99}{\micro\Molar} ZnSO\textsubscript{4}.7H\textsubscript{2}O, \SI{5}{\micro\Molar} KI, \SI{1.03}{\micro\Molar} Na\textsubscript{2}MoO\textsubscript{4}.2H\textsubscript{2}O, \SI{0.1}{\micro\Molar} CuSO\textsubscript{4}.5H\textsubscript{2}O, \SI{0.09}{\micro\Molar} COCl\textsubscript{2}.6H\textsubscript{2}O, \SI{100}{\micro\Molar}  NaFe\hyp{}EDTA, \SI{0.12}{\g\per\l} Gamborg B5 vitamins) K3G1 nutrient solution without hormones to pH 5.7 with KOH.
K3G1 mediums were filter sterilised with a Sartorious Minisart® syringe \SI{0.22}{\um} filter.
\SI{200}{\micro\litre} of \SI{0.1}{\percent} BSA (bovine serum albumin) solution was added to wells in a new spectrophotometer plate.
After 2 minutes, BSA was removed, and protoplasts were added to wells in the new plate.
For leaf protoplasts the spectrophotometer plate was incubated overnight for 18 hours with light intensity of approximately \SI{70}{\umol\per\square\meter\per\s} at \SI{22}{\degreeCelsius}.
For root protoplasts the plate was wrapped in foil and incubated for 18 hours in the dark.
For some nitrate experiments protoplasts were induced with either \SI{10}{\milli\Molar} final concentration KNO\textsubscript{3} in W5 buffer, or W5 buffer on its own in the morning for 2 hours before continuing to the luciferase assay.

\section{Luciferase assay}\label{chapter2:methods:luciferase-assay}

Protoplasts were removed from the illuminated incubator and centrifuged for 2 minutes at 200~RCF.
A lysis buffer\hyp{}protease inhibitor mix was made, containing a 1/5 dilution of 5X Promega passive lysis buffer E1941, 1/100 dilution of Sigma protease inhibitor cocktail P9599.
Supernatant was removed, and \SI{30}{\micro\litre} of lysis buffer protease inhibitor mix was added to each well, pipetting up and down to mix.
The plate was put on ice for 15 minutes, then centrifuged at 3700~RCF for 10 minutes at \SI{4}{\degreeCelsius}.
\SI{30}{\micro\litre} of lysed protoplasts were added to each well on a 4titude 96 well white polystyrene microplate solid bottom plate reader plate. 
The Promega Nano\hyp{}Glo\textsuperscript{®}Dual\hyp{}Luciferase\textsuperscript{®} Reporter Assay System was used.
\SI{30}{\micro\litre} of ONE\hyp{}Glo\textsuperscript{TM} EX Reagent was added to the lysed protoplasts on the white plate, and the solution was mixed by pipetting three times.
The plate was incubated in the dark at room temperature for five minutes. Luminescence was measured using a CLARIOstar Plus plate reader.
Focus was adjusted automatically, and each well was measured for ten seconds at 3600 gain, settling time one second.
This measured firefly luciferase luminescence.
NanoDLR\textsuperscript{TM} Stop \& Glo\textsuperscript{®} Reagent was prepared by diluting the substrate 100x in the buffer, and then \SI{30}{\micro\litre} was added to each well.
The plate was then incubated in the dark at room temperature for five minutes, and then the plate was read in the same way as before.
This measured the nano\hyp{}luciferase luminescence.

\section{Transformation of electrocompetent~\textit{Agrobacterium tumefaciens}}

GV3101 Agrobacterium cells were thawed on ice.
Sterile \SI{2}{\mm} cuvettes (Geneflow E6\hyp{}0060) and chamber slide were placed on ice.
\SI{20}{\micro\litre} of bacteria and \SI{0.9}{\micro\litre} of \SI{110}{\nano\gram\per\micro\litre} DNA were added to each cuvette.
Cuvettes were placed in the chamber slide on a BioRad Gene Pulser Xcell and were electroporated with one pulse using the Agro program (\SI{2.5}{\kilo\volt}).
\SI{500}{\micro\litre} of terrific broth~\autocite{tartoffImprovedMediaGrowing} was added to each cuvette and then the contents was transferred to \SI{1.5}{\ml} microcentrifuge tubes.
Agrobacteria was incubated at \SI{28}{\degree\celsius} for 2 hours with 220 rpm shaking.
Tubes were then centrifuged at 10000 RCF for 1 minute after which the supernatant was removed leaving \SI{40}{\micro\litre} in the bottom.
Cells were resuspended and then \SI{20}{\micro\litre} was transferred to flat-bottom 6 well plates (CytoOne CC7672\hyp{}7506) containing LB agar with \SI{50}{\micro\gram\per\ml} spectinomycin, \SI{50}{\micro\gram\per\ml} rifampicin and \SI{25}{\micro\gram\per\ml} gentamicin selection.
Glass beads were used to spread the plates.
Plates were then incubated for 2\textendash{}3 days at \SI{28}{\degree\celsius}.

Medium sized colonies were grown overnight in \SI{5}{\ml} liquid LB with \SI{50}{\micro\gram\per\ml} spectinomycin, \SI{50}{\micro\gram\per\ml} rifampicin and \SI{25}{\micro\gram\per\ml} gentamicin selection at \SI{28}{\degree\celsius} with 220 rpm shaking.
\SI{20}{\percent} glycerol stocks were taken and stored at \SI{-70}{\degreeCelsius}.

\section{Transformation of \textit{Arabidopsis thaliana} by floral dip}\label{chapter2:methods:floral-dip}

Col-0 Arabidopsis plants were grown in soil with long days until flowering (\textasciitilde{}4 weeks old).
For the CRISPR library, 96 Agrobacteria strains (each containing one of the 96 CRISPR constructs described in section~\ref{chapter2:methods:design-of-guides} Design of guides and construction of CRISPR library) were grown overnight in \SI{5}{\ml} liquid LB with \SI{50}{\micro\gram\per\ml} spectinomycin, \SI{50}{\micro\gram\per\ml} rifampicin and \SI{25}{\micro\gram\per\ml} gentamicin selection at \SI{28}{\degree\celsius} with 220 rpm shaking.
Cells were centrifuged at 3700 RCF for 10 mins and resuspended in fresh \SI{5}{\percent} sucrose solution to OD600 \textasciitilde{}0.8.
All strains were mixed together equally (\SI{3}{\ml} each) and Silvet L-77 was added to \SI{0.05}{\percent}.
Agrobacteria was transferred to \SI{9x30}{\ml} spray bottles.
Arabidopsis plants were placed inside an autoclave bag and the flowers were sprayed with the Agrobacteria.
Autoclave bags were taped closed and placed inside black bin liners for 24 hours before being removed from both bags.
Plants were grown with long days until seeds collection, where a paper seed bag was taped over the influorescence of plants for collection.
Transgenic Seeds were then sown on \SI{0.8}{\percent} LB \SI{3}{\percent} sucrose agar with \SI{100}{\micro\gram\per\ml} Kanamycin selection.
Wild type Col-0 seeds were sown without Kanamycin selection.
After 2\textendash{}3 weeks, 200 transgenic and 8 wild type T1 plants were transferred to soil.
These plants were bagged for seed collection once they were flowering.

\end{document}